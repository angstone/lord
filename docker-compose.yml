version: '3'
services:

  eventstore:
    image: eventstore/eventstore:release-4.0.3
    ports:
      - "2113:2113"
      - "1113:1113"

  elastic:
    image: docker.elastic.co/elasticsearch/elasticsearch:6.1.1
    ports:
      - "9200:9200"
      - "9300:9300"
    environment:
      - discovery.type=single-node

  nats:
    image: 'nats:0.8.0'
    entrypoint: "/gnatsd -DV"
    expose:
      - "4222"
    ports:
      - "8222:8222"
    hostname: nats

  router-service:
    build: ./router-service
    ports:
      - "3000:3000"
    volumes:
      - ./router-service:/home/node/app
      - ./routes:/home/node/routes
    depends_on:
      - nats

  ping-service:
    build: ./ping-service
    volumes:
      - ./ping-service:/home/node/app
    depends_on:
      - nats

  users-reducer-service:
    build: ./users-reducer-service
    volumes:
      - ./users-reducer-service:/home/node/app
      - ./rules:/home/node/rules
    depends_on:
      - nats
      - eventstore

  users-signup-service:
    build: ./users-signup-service
    volumes:
      - ./users-signup-service:/home/node/app
      - ./rules:/home/node/rules
    depends_on:
      - nats
      - eventstore
      - users-reducer-service
